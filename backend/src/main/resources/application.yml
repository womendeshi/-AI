server:
  port: 8080

spring:
  datasource:
    url: jdbc:mysql://localhost:3306/ai_story_studio?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai&useSSL=false&allowPublicKeyRetrieval=true
    username: root
    password: 123456
  # 文件上传配置
  servlet:
    multipart:
      # 单个文件最大大小
      max-file-size: 50MB
      # 请求最大大小
      max-request-size: 50MB
  flyway:
    enabled: true
    baseline-on-migrate: true
  data:
    # Redis配置
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      database: 4
      timeout: 3000ms
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 0
          max-wait: -1ms
  # RabbitMQ配置
  rabbitmq:
    host: ${RABBITMQ_HOST:localhost}
    port: ${RABBITMQ_PORT:5672}
    username: ${RABBITMQ_USERNAME:admin}
    password: ${RABBITMQ_PASSWORD:admin123}
    virtual-host: ${RABBITMQ_VHOST:/}
    listener:
      simple:
        # 消费者最小数量
        concurrency: 5
        # 消费者最大数量
        max-concurrency: 10
        # 手动确认消息
        acknowledge-mode: manual
        # 每次从队列获取消息数量
        prefetch: 1
        # 启动时自动启动
        auto-startup: true
        # 消费失败后重新入队
        default-requeue-rejected: false
    # 发送确认
    publisher-confirm-type: correlated
    # 发送失败退回
    publisher-returns: true
    template:
      mandatory: true

mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true

# JWT认证配置
jwt:
  # JWT密钥（生产环境请使用环境变量配置）
  secret: ai-story-studio-jwt-secret-key-2025-very-long-and-secure-string-for-production
  # Token过期时间（7天，单位：毫秒）
  expiration: 604800000
  # Token请求头名称
  header: Authorization
  # Token前缀
  prefix: "Bearer "

# 存储服务配置
storage:
  # 存储提供商: oss (阿里云OSS), minio (MinIO - V2规划)
  provider: oss
  oss:
    # OSS访问端点（根据区域选择）
    endpoint: oss-cn-hangzhou.aliyuncs.com
    # 存储桶名称
    bucket: yuanmeng-logo
    # 访问密钥ID（生产环境强烈建议使用环境变量）
    access-key-id: ${OSS_ACCESS_KEY_ID:your-access-key-id}
    # 访问密钥Secret（生产环境强烈建议使用环境变量）
    access-key-secret: ${OSS_ACCESS_KEY_SECRET:your-access-key-secret}
    # 区域代码
    region: cn-hangzhou
    # URL前缀（可选，用于CDN加速）
    # url-prefix: https://cdn.example.com
  sms:
    provider: ${SMS_PROVIDER:mock}
    aliyun:
      access-key-id: ${ALIYUN_SMS_ACCESS_KEY_ID:}
      access-key-secret: ${ALIYUN_SMS_ACCESS_KEY_SECRET:}
      sign-name: ${ALIYUN_SMS_SIGN_NAME:圆梦动画}
      template-code: ${ALIYUN_SMS_TEMPLATE_CODE:}

# AI服务配置
ai:
  # 向量引擎中转站配置
  vectorengine:
    # API基础URL
    base-url: https://api.vectorengine.ai
    # API密钥（生产环境强烈建议使用环境变量）
    api-key: ${AI_API_KEY:sk-a9VY9DmeSn1YSqpxNtOpyZQ6CKZoSnSB5X22kMk8X0gKUOOy}
    # 请求超时时间（毫秒）
    timeout: 60000
    # 连接超时时间（毫秒）
    connect-timeout: 10000
    # 读取超时时间（毫秒）
    read-timeout: 60000

  # 文本生成模型配置
  text:
    # 默认模型
    model: gemini-3-pro-preview
    # 最大token数
    max-tokens: 4096
    # 温度参数（0-1，越高越随机）
    temperature: 0.7
    # 采样参数
    top-p: 0.9

  # 图片生成模型配置
  image:
    # 默认模型
    default-model: gemini-3-pro-image-preview
    # 是否启用即梦反代
    jimeng-proxy-enabled: true
    # 即梦模型
    jimeng-model: jimeng-4.5
    # 默认画幅比例
    default-aspect-ratio: "21:9"
    # 默认生成数量
    default-count: 1
    # 即梦反代配置
    jimeng-proxy:
      # 反代服务器基础URL
      base-url: http://YOUR_JIMENG_PROXY_HOST:PORT
      # 会话ID（用于认证）
      sessionid: YOUR_SESSION_ID
      # 是否启用即梦反代
      enabled: true
      # API端点路径 - 文生图
      text-to-image-endpoint: /v1/images/generations
      # API端点路径 - 图生图
      image-to-image-endpoint: /v1/images/compositions
      # 连接超时时间（毫秒）
      connect-timeout: 30000
      # 读取超时时间（毫秒）
      read-timeout: 60000

  # 视频生成模型配置
  video:
    # 默认模型
    model: sora-2
    # 默认画幅比例
    default-aspect-ratio: "16:9"
    # 默认时长（秒）
    default-duration: 5
    # 最大时长（秒）
    max-duration: 10
    # 轮询间隔（毫秒）
    poll-interval: 5000
    # 最大轮询次数
    max-poll-count: 120

wechat:
  pay:
    merchant-id: TEST_MERCHANT_ID
    app-id: TEST_APP_ID
    api-v3-key: TEST_API_V3_KEY_32_CHARACTERS_LONG_PLACEHOLDER
    private-key-path: classpath:wechat/test_key.pem
    merchant-serial-number: TEST_SERIAL_NUMBER
    notify-url: http://localhost:8080/api/recharge/notify/wechat


logging:
  level:
    root: INFO
    org.flywaydb: DEBUG
    org.springframework.boot.autoconfigure.flyway: DEBUG
    # OSS服务日志
    com.ym.ai_story_studio_server.service.impl.OssStorageServiceImpl: INFO
    com.ym.ai_story_studio_server.util.RedisUtil: DEBUG
    com.ym.ai_story_studio_server.service.impl.AuthServiceImpl: INFO

management:
  endpoints:
    web:
      exposure:
        include: metrics,health,info
  metrics:
    enable:
      executor: true


my:
  marker: "app-yml-loaded"